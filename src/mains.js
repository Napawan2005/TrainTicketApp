//=============================
    // 1) ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤ (TH/EN)
   
    const translations = {
        
      th: {
        
        menuHome: "‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å",
        menuLogin: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
        menuSearch: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü",
        menuPayment: "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
        menuHistory: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á",

        homeTitle: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü",
        homeDesc: "‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡πã‡∏ß‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πã‡∏ß‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡πà‡∏≤‡∏á‡πÜ",
        recommended:"‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡πã‡∏ß‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô",
        ticket:"‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏ï‡πà‡∏≤‡∏á‡πÜ",

        loginTitle: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
        labelUsername: "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)",
        labelPassword: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)",
        btnLogin: "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô",

        searchTitle: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü",
        departure_station:"-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á --",
        Bangkok:"‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø",
        ChiangMai:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
        Korat:"‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä",
        arrival_station:"-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á --",

        labelFrom: "‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á",
        labelTo: "‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á",
        labelDateSearch: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á",
        btnSearchTickets: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤",

        paymentTitle: "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
        method:"-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á --",
        labelPaymentMethod: "‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
        labelPaymentDetails: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
        btnConfirmPayment: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",

        historyTitle: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á",

        footerText: "¬© 2025 TrainBooking. All Rights Reserved.",
      },
      en: {
       
        menuHome: "Home",
        menuLogin: "Login",
        menuSearch: "Search Tickets",
        menuPayment: "Payment",
        menuHistory: "History",

        homeTitle: "Welcome to Train Ticket Booking System",
        homeDesc: "Please login to proceed, or check out our recommended tickets and ticket listings.",
        recommended:"Recommend tickets and promotions",  
        ticket:"Train tickets for various stations",

        loginTitle: "Login",
        labelUsername: "Username",
        labelPassword: "Password",
        btnLogin: "Login",

        searchTitle: "Search Train Tickets",
        departure_station:"-- Select origin --",
        Bangkok:"Bangkok",
        ChiangMai:"Chiang Mai",
        Korat:"Korat",
        arrival_station:"--Select destination--",

        labelFrom: "From",
        labelTo: "To",
        labelDateSearch: "Travel Date",
        btnSearchTickets: "Search",

        paymentTitle: "Payment",
        method:"-- Choose a method --",
        labelPaymentMethod: "Payment Method",
        labelPaymentDetails: "Payment Details",
        btnConfirmPayment: "Confirm Payment",

        historyTitle: "Booking History",

        footerText: "¬© 2025 TrainBooking. All Rights Reserved.",
      },
    };
function setLanguage(lang) {
Object.keys(translations[lang]).forEach((id) => {
  const el = document.getElementById(id);
  if (el) {
    el.textContent = translations[lang][id];
  }
});
updateTableHeaders(lang);
}

function updateTableHeaders(lang) {
// Update dynamic table headers if needed.
}

//=============================
// 1.5) Dark Mode Toggle
function toggleDarkMode() {
document.body.classList.toggle('dark-mode');
}
document.getElementById('btnDarkMode').addEventListener('click', toggleDarkMode);

//=============================
// 2) ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (Navigation)
const homeSection = document.getElementById("homeSection");
const loginSection = document.getElementById("loginSection");
const searchSection = document.getElementById("searchSection");
const seatSelectionSection = document.getElementById("seatSelectionSection");
const paymentSection = document.getElementById("paymentSection");
const historySection = document.getElementById("historySection");
const AdminSection = document.getElementById("adminSection");

function showSection(sectionId) {
  [homeSection, loginSection, searchSection, seatSelectionSection, paymentSection, historySection, AdminSection].forEach(sec => {
    sec.classList.remove("active");
  });
  document.getElementById(sectionId).classList.add("active");
}

//=============================
// 3) ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Login)
let currentUser = null;
const loginError = document.getElementById("loginError");
const usernameInput = document.getElementById("username");
const passwordInput = document.getElementById("password");

function validatePassword(password) {
const hasUpperCase = /[A-Z]/.test(password);
const hasLowerCase = /[a-z]/.test(password);
const hasDigit = /[0-9]/.test(password);
return hasUpperCase && hasLowerCase && hasDigit;
}

document.getElementById("btnLogin").addEventListener("click", () => {
const username = usernameInput.value.trim();
const password = passwordInput.value;
if (!username || !password) {
  loginError.textContent = "(TH)‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (EN)Please enter your username and password.";
  return;
}
if (!validatePassword(password)) {
  loginError.textContent = "(TH)‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà, ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å, ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß(EN)The password must contain at least one uppercase letter, one lowercase letter, and one number.";
  return;
}
currentUser = { username };
loginError.textContent = "";
alert("Login Successfulüéâ!");
showSection("homeSection");
renderRecommendedTickets();
renderTicketsListing();
});

//=============================
// 4) ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü (Search Tickets)
const searchForm = document.getElementById("searchForm");
const searchResult = document.getElementById("searchResult");
const mockTrains = [
{ id: 1, from: "Bangkok", to: "Chiang Mai", date: "2025-03-10", time: "08:00", seatsAvailable: 50 },
{ id: 2, from: "Bangkok", to: "Chiang Mai", date: "2025-03-10", time: "13:00", seatsAvailable: 30 },
{ id: 3, from: "Bangkok", to: "Korat",      date: "2025-03-11", time: "09:30", seatsAvailable: 20 },
{ id: 4, from: "Chiang Mai", to: "Bangkok", date: "2025-03-12", time: "18:00", seatsAvailable: 25 },
];

searchForm.addEventListener("submit", (e) => {
e.preventDefault();
if (!currentUser) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü");
  return;
}
const from = document.getElementById("searchFrom").value;
const to = document.getElementById("searchTo").value;
const date = document.getElementById("searchDate").value;
if (!from || !to || !date) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  return;
}
if (from === to) {
  alert("‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô");
  return;
}
const filtered = mockTrains.filter(train => train.from === from && train.to === to && train.date === date);
if (filtered.length === 0) {
  searchResult.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏ñ‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>";
  return;
}
let tableHTML = `
  <table class="tickets-table">
    <thead>
      <tr>
        <th>‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á</th>
        <th>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
        <th>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á</th>
        <th>‡∏à‡∏≠‡∏á</th>
      </tr>
    </thead>
    <tbody>
`;
filtered.forEach(train => {
  tableHTML += `
    <tr>
      <td>${train.from}</td>
      <td>${train.to}</td>
      <td>${train.date}</td>
      <td>${train.time}</td>
      <td>${train.seatsAvailable}</td>
      <td><button onclick="bookTrain(${train.id})">‡∏à‡∏≠‡∏á</button></td>
    </tr>
  `;
});
tableHTML += `</tbody></table>`;
searchResult.innerHTML = tableHTML;
});

//=============================
// 5) ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á (Seat Selection)
let selectedTrain = null;
let selectedSeats = [];
const maxSelectableSeats = 4;
const seatPrice = 300;
const disabledSeatIds = ["A1","A2","B1","B2"];
const elderSeatIds    = ["A4","A5","B4","B5"];

window.bookTrain = function(trainId) {
selectedTrain = mockTrains.find(t => t.id === trainId);
if (!selectedTrain) return;
showSection("seatSelectionSection");
renderSeatSelection();
};

function renderSeatSelection() {
if (!selectedTrain) return;
selectedSeats = [];
const seatTrainInfo = document.getElementById("seatTrainInfo");
seatTrainInfo.innerHTML = `
  <p><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á:</strong> ${selectedTrain.from}</p>
  <p><strong>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</strong> ${selectedTrain.to}</p>
  <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${selectedTrain.date}</p>
  <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${selectedTrain.time}</p>
`;
const seatMapContainer = document.getElementById("seatMap");
let seatTableHTML = '<table class="seat-table"><tbody>';
const totalSeats = 50; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥ 10 ‡πÅ‡∏ñ‡∏ß x 5 ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á = 50 ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
let seatIndex = 0;
for (let rowChar = 65; rowChar < 65 + 10; rowChar++) {
  const row = String.fromCharCode(rowChar);
  seatTableHTML += "<tr>";
  for (let col = 1; col <= 5; col++) {
    seatIndex++;
    const seatId = row + col;
    let seatTypeClass = "";
    if (disabledSeatIds.includes(seatId)) {
      seatTypeClass = " disabled";
    } else if (elderSeatIds.includes(seatId)) {
      seatTypeClass = " elder";
    }
    let occupied = false;
    if (seatIndex > selectedTrain.seatsAvailable) {
      occupied = true;
    }
    if (occupied) {
      seatTableHTML += `<td><button class="seat occupied" disabled>${seatId}</button></td>`;
    } else {
      seatTableHTML += `<td><button class="seat${seatTypeClass}" onclick="toggleSeat(this, '${seatId}')">${seatId}</button></td>`;
    }
  }
  seatTableHTML += "</tr>";
}
seatTableHTML += "</tbody></table>";
seatMapContainer.innerHTML = seatTableHTML;
document.getElementById("selectedSeatsInfo").innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</p>";
}

window.toggleSeat = function(elem, seatId) {
if (selectedSeats.includes(seatId)) {
  selectedSeats = selectedSeats.filter(id => id !== seatId);
  elem.classList.remove("selected");
} else {
  if (selectedSeats.length >= Math.min(maxSelectableSeats, selectedTrain.seatsAvailable)) {
    alert(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${Math.min(maxSelectableSeats, selectedTrain.seatsAvailable)} ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á`);
    return;
  }
  selectedSeats.push(seatId);
  elem.classList.add("selected");
}
updateSelectedSeatsInfo();
};

function updateSelectedSeatsInfo() {
const infoDiv = document.getElementById("selectedSeatsInfo");
if (selectedSeats.length === 0) {
  infoDiv.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</p>";
} else {
  let html = "<p><strong>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong></p><ul>";
  selectedSeats.forEach(id => {
    let typeText = "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏õ‡∏Å‡∏ï‡∏¥";
    if (disabledSeatIds.includes(id)) {
      typeText = "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏Å‡∏≤‡∏£";
    } else if (elderSeatIds.includes(id)) {
      typeText = "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏";
    }
    html += `<li>${id} (${typeText}) - ${seatPrice} ‡∏ö‡∏≤‡∏ó</li>`;
  });
  html += `</ul><p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${selectedSeats.length * seatPrice} ‡∏ö‡∏≤‡∏ó</p>`;
  infoDiv.innerHTML = html;
}
}

document.getElementById("btnConfirmSeats").addEventListener("click", () => {
if (!selectedTrain || selectedSeats.length === 0) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á");
  return;
}
selectedTrain.selectedSeats = [...selectedSeats];
selectedTrain.totalPrice = selectedSeats.length * seatPrice;
selectedTrain.seatsAvailable -= selectedSeats.length;
showSection("paymentSection");
renderPaymentInfo();
});

//=============================
// 6) ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payment)
const paymentInfo = document.getElementById("paymentInfo");
function renderPaymentInfo() {
if (!selectedTrain) {
  paymentInfo.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ‡πÑ‡∏ü</p>";
  return;
}
let freeSeatHTML = "";
let seatsInfoHTML = "";
if (!selectedTrain.selectedSeats || selectedTrain.selectedSeats.length === 0) {
  freeSeatHTML = `<p><strong>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á:</strong> ${selectedTrain.seatsAvailable}</p>`;
} else {
  seatsInfoHTML = `
    <p><strong>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> ${selectedTrain.selectedSeats.join(", ")}</p>
    <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${selectedTrain.totalPrice} ‡∏ö‡∏≤‡∏ó</p>
  `;
}
paymentInfo.innerHTML = `
  <p><strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á:</strong> ${selectedTrain.from}</p>
  <p><strong>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</strong> ${selectedTrain.to}</p>
  <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${selectedTrain.date}</p>
  <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${selectedTrain.time}</p>
  ${freeSeatHTML}
  ${seatsInfoHTML}
`;
}

const paymentForm = document.getElementById("paymentForm");
const paymentResult = document.getElementById("paymentResult");

paymentForm.addEventListener("submit", (e) => {
e.preventDefault();
if (!selectedTrain) {
  alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
  return;
}
if (!currentUser) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
  return;
}
const paymentMethod = document.getElementById("paymentMethod").value;
const paymentDetails = document.getElementById("paymentDetails").value;
if (!paymentMethod || !paymentDetails) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  return;
}
paymentResult.innerHTML = `<p style="color: green;">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>`;
saveBookingHistory({
  username: currentUser.username,
  from: selectedTrain.from,
  to: selectedTrain.to,
  date: selectedTrain.date,
  time: selectedTrain.time,
  seats: selectedTrain.selectedSeats || [],
  totalPrice: selectedTrain.totalPrice || 0,
  paymentMethod: paymentMethod,
  bookingDate: new Date().toLocaleString(),
});
selectedTrain = null;
selectedSeats = [];
renderPaymentInfo();
paymentForm.reset();
});

//=============================
// 7) ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (History)
const historyList = document.getElementById("historyList");

function saveBookingHistory(booking) {
let historyData = JSON.parse(localStorage.getItem("bookingHistory")) || [];
historyData.push(booking);
localStorage.setItem("bookingHistory", JSON.stringify(historyData));
}

function loadBookingHistory() {
let historyData = JSON.parse(localStorage.getItem("bookingHistory")) || [];
if (historyData.length === 0) {
  historyList.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>";
  return;
}
let html = "";
historyData.forEach(item => {
  if (currentUser && item.username === currentUser.username) {
    html += `
      <div class="history-item">
        <p><strong>‡∏à‡∏≤‡∏Å:</strong> ${item.from}</p>
        <p><strong>‡πÑ‡∏õ:</strong> ${item.to}</p>
        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${item.date}</p>
        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${item.time}</p>
        ${item.seats && item.seats.length > 0 ? `<p><strong>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á:</strong> ${item.seats.join(", ")}</p>` : ""}\n          ${item.totalPrice ? `<p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${item.totalPrice} ‡∏ö‡∏≤‡∏ó</p>` : ""}\n          <p><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${item.paymentMethod}</p>\n          <p><strong>‡∏à‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${item.bookingDate}</p>\n        </div>\n      `;
  }
});
historyList.innerHTML = html || "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ</p>";
}

//=============================
// 8) Recommended Tickets & Tickets Listing (Home)
const recommendedTickets = [
{
  id: 101,
  from: "Bangkok",
  to: "Chiang Mai",
  image: "https://via.placeholder.com/280x150/2c62ec/ffffff?text=Bangkok+to+Chiang+Mai",
  title: "Bangkok to Chiang Mai",
  description: "‡∏ï‡∏±‡πã‡∏ß‡πÇ‡∏õ‡∏£‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏° ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©!"
},
{
  id: 102,
  from: "Bangkok",
  to: "Korat",
  image: "https://via.placeholder.com/280x150/2c62ec/ffffff?text=Bangkok+to+Korat",
  title: "Bangkok to Korat",
  description: "‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß"
},
{
  id: 103,
  from: "Chiang Mai",
  to: "Bangkok",
  image: "https://via.placeholder.com/280x150/2c62ec/ffffff?text=Chiang+Mai+to+Bangkok",
  title: "Chiang Mai to Bangkok",
  description: "‡∏à‡∏≠‡∏á‡∏î‡πà‡∏ß‡∏ô! ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î"
}
];

function renderRecommendedTickets() {
const container = document.getElementById("recommendedContainer");
if (!container) return;
container.innerHTML = "";
recommendedTickets.forEach(ticket => {
  const card = document.createElement("div");
  card.classList.add("card");
  card.innerHTML = `
    <img src="${ticket.image}" alt="${ticket.title}">
    <div class="card-content">
      <h4>${ticket.title}</h4>
      <p>${ticket.description}</p>
    </div>
  `;
  container.appendChild(card);
});
}

function renderTicketsListing() {
const container = document.getElementById("ticketsListing");
if (!container) return;
let tableHTML = `
  <table class="tickets-table">
    <thead>
      <tr>
        <th>‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á</th>
        <th>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
        <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
        <th>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á</th>
        <th>‡∏à‡∏≠‡∏á</th>
      </tr>
    </thead>
    <tbody>
`;
mockTrains.forEach(train => {
  tableHTML += `
    <tr>
      <td>${train.from}</td>
      <td>${train.to}</td>
      <td>${train.date}</td>
      <td>${train.time}</td>
      <td>${train.seatsAvailable}</td>
      <td><button onclick="bookTrain(${train.id})">‡∏à‡∏≠‡∏á</button></td>
    </tr>
  `;
});
tableHTML += `</tbody></table>`;
container.innerHTML = tableHTML;
}

//=============================
// 9) ‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö Section ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π
document.getElementById("menuHome").addEventListener("click", () => {
showSection("homeSection");
renderRecommendedTickets();
renderTicketsListing();
});
document.getElementById("menuLogin").addEventListener("click", () => {
showSection("loginSection");
});
document.getElementById("menuSearch").addEventListener("click", () => {
if (!currentUser) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô!");
  return;
}
showSection("searchSection");
});
document.getElementById("menuPayment").addEventListener("click", () => {
if (!currentUser) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô!");
  return;
}
showSection("paymentSection");
renderPaymentInfo();
});
document.getElementById("menuHistory").addEventListener("click", () => {
if (!currentUser) {
  alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô!");
  return;
}
showSection("historySection");
loadBookingHistory();
});

//=============================
// 10) ‡∏™‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤
const btnTH = document.getElementById("btnTH");
const btnEN = document.getElementById("btnEN");

btnTH.addEventListener("click", () => { setLanguage("th"); });
btnEN.addEventListener("click", () => { setLanguage("en"); });

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Admin ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
function checkAdminAccess() {
  if (!currentUser || currentUser.role !== 'admin') {
    document.getElementById("adminSection").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô Admin
    document.getElementById("menuAdmin").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π Admin
  } else {
    document.getElementById("adminSection").style.display = "block";
    document.getElementById("menuAdmin").style.display = "block";
  }
}

// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
document.getElementById("btnLogin").addEventListener("click", () => {
  // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÉ‡∏´‡πâ username "admin" ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
  const username = document.getElementById("username").value.trim();
  currentUser = { username, role: username.toLowerCase() === "admin" ? "admin" : "user" };

  alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  checkAdminAccess();
  showSection("homeSection");
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ Admin Dashboard (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
document.getElementById("menuAdmin").addEventListener("click", () => {
  if (!currentUser || currentUser.role !== 'admin') {
    alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
    return;
  }
  showSection("homeSection");
  renderTrainList();
  loadBookingHistory(true); // ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü
document.getElementById("addTrainForm").addEventListener("submit", (e) => {
  e.preventDefault();
  if (!currentUser || currentUser.role !== 'admin') {
    alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡πã‡∏ß");
    return;
  }

  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
  const from = document.getElementById("trainFrom").value.trim();
  const to = document.getElementById("trainTo").value.trim();
  const date = document.getElementById("trainDate").value;
  const time = document.getElementById("trainTime").value;
  const seats = parseInt(document.getElementById("trainSeats").value);

  if (!from || !to || !date || !time || isNaN(seats) || seats < 1) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    return;
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πã‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÑ‡∏õ
  const newTrain = {
    id: Date.now(), // ‡πÉ‡∏ä‡πâ Timestamp ‡πÄ‡∏õ‡πá‡∏ô id
    from,
    to,
    date,
    time,
    seatsAvailable: seats
  };

  mockTrains.push(newTrain);
  alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
  renderTrainList(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏±‡πã‡∏ß
  document.getElementById("addTrainForm").reset();
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü (‡∏£‡∏ß‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö)
function renderTrainList() {
  const tableBody = document.getElementById("trainListBody");
  tableBody.innerHTML = "";
  
  if (mockTrains.length === 0) {
    tableBody.innerHTML = "<tr><td colspan='6'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü</td></tr>";
    return;
  }

  mockTrains.forEach((train) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${train.from}</td>
      <td>${train.to}</td>
      <td>${train.date}</td>
      <td>${train.time}</td>
      <td>${train.seatsAvailable}</td>
      <td><button class="deleteTrainBtn" data-id="${train.id}">‚ùå</button></td>
    `;
    tableBody.appendChild(row);
  });
}

// ‡∏•‡∏ö‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü
document.getElementById("trainListTable").addEventListener("click", (e) => {
  if (e.target.classList.contains("deleteTrainBtn")) {
    const trainId = parseInt(e.target.getAttribute("data-id"));
    const index = mockTrains.findIndex((t) => t.id === trainId);
    if (index !== -1) {
      mockTrains.splice(index, 1);
      alert("‡∏•‡∏ö‡∏ï‡∏±‡πã‡∏ß‡∏£‡∏ñ‡πÑ‡∏ü‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
      renderTrainList();
    }
  }
});

// ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin)
function loadBookingHistory(isAdmin = false) {
  const historyContainer = document.getElementById("adminBookingHistory");
  if (!isAdmin || currentUser.role !== "admin") return;

  historyContainer.innerHTML = "";
  if (bookingHistory.length === 0) {
    historyContainer.innerHTML = "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>";
    return;
  }

  bookingHistory.forEach((item) => {
    const historyItem = document.createElement("div");
    historyItem.classList.add("history-item");
    historyItem.innerHTML = `
      <p><strong>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> ${item.username}</p>
      <p><strong>‡∏à‡∏≤‡∏Å:</strong> ${item.from} ‚Üí <strong>‡πÑ‡∏õ:</strong> ${item.to}</p>
      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${item.date}</p>
      <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${item.time}</p>
      <p><strong>‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á:</strong> ${item.seats.join(", ")}</p>
      <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${item.totalPrice} ‡∏ö‡∏≤‡∏ó</p>
      <p><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${item.paymentMethod}</p>
      <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á:</strong> ${item.bookingDate}</p>
    `;
    historyContainer.appendChild(historyItem);
  });
}




// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
checkAdminAccess();


// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
setLanguage("th");
showSection("homeSection");
renderRecommendedTickets();
renderTicketsListing();

